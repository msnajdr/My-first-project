
/*

-Software License Agreement (BSD License)

-http://taffydb.com/?oa=agree

-1.7.3

-*/
(function(window,undefined){var TAFFY=function(obj){obj=obj||[];var conf={template:null},T=TAFFY,raw=(T.isString(obj))?T.JSON.parse(obj):obj,TOb=raw,TIA=[],t=true,f=false;function mergeTemp(rows,tmpl){var tmpl=tmpl||conf.template;if(!TAFFY.isNull(tmpl)){for(var x=0,xl=rows.length;x<xl;x++){TOb[rows[x]]=TAFFY.mergeObj(TOb[rows[x]],tmpl)}}}function bTIA(){TIA=[];for(var x=0,xl=TOb.length;x<xl;x++){TIA[TIA.length]=x}}bTIA();var findTests={pickTest:function(Tt){var m=(Tt.indexOf("!")===0)?f:t;if(!m){Tt=Tt.substring(1,Tt.length)}return{test:(Tt=="equal")?"is":(Tt=="notequal")?"not":(Tt=="startswith")?"starts":(Tt=="endswith")?"ends":(Tt=="greaterthan")?"gt":(Tt=="lessthan")?"lt":(Tt=="regexppass")?"regex":Tt,mode:(m)?{s:t,f:f}:{s:f,f:t}}},run:function(s,mvalue,mtest,b){return((s=="regex")?(mtest.test(mvalue)):(s=="lt")?(mvalue<mtest):(s=="gt")?(mvalue>mtest):(s=="lte")?(mvalue<=mtest):(s=="gte")?(mvalue>=mtest):(s=="starts")?(mvalue.indexOf(mtest)===0):(s=="ends")?(mvalue.substring((mvalue.length-mtest.length))==mtest):(s=="like")?(mvalue.indexOf(mtest)>=0):(s=="is")?(mvalue==mtest):(s=="has")?(T.has(mvalue,mtest)):(s=="hasAll")?(T.hasAll(mvalue,mtest)):(s=="length")?(findTests.length(mvalue,mtest,b)):findTests[s](mvalue,mtest))?b.s:b.f},length:function(mvalue,mtest,b){var rlen=(!T.isUndefined(mvalue.length))?mvalue.length:(!T.isUndefined(mvalue.getLength))?mvalue.getLength():0;if(T.isObject(mtest)){for(var kt in mtest){if(mtest.hasOwnProperty(kt)){var pt=findTests.pickTest(kt);return findTests.run(pt.test,rlen,mtest[kt],pt.mode)?t:f}}}return rlen==mtest?b.s:b.f}};(function(){for(var z in TAFFY){if(TAFFY.hasOwnProperty(z)&&z.indexOf("is")===0){(function(y){findTests["is"+y]=function(mvalue,mtest,b){return(TAFFY["is"+y](mvalue)==mtest)?t:f}})(z.substring(2,z.length))}}})();function bDexArray(iA,f){var rA=[];if(!T.isArray(iA)&&TAFFY.isNumber(iA)){rA[rA.length]=iA}else{if(T.isArray(iA)){rA=iA}else{if(T.isObject(iA)){rA=f(iA)}else{if(!T.isArray(iA)&&!T.isNumber(iA)){rA=TIA}}}}return rA}function toLogicalArray(value){var rArray=[0],type="none",value=value+"";if(!T.isNull(value)&&!T.isUndefined(value)){for(var n=0,nl=value.length;n<nl;n++){var c=value.slice(n,(n+1));if(T.isNumeric(c)){if(type!="number"){rArray[rArray.length]=c;type="number"}else{rArray[(rArray.length-1)]=rArray[(rArray.length-1)]+""+c}}else{if(type!="string"){rArray[rArray.length]=c;type="string"}else{rArray[(rArray.length-1)]=rArray[(rArray.length-1)]+c}}}for(var n=0,nl=rArray.length;n<nl;n++){if(T.isNumeric(rArray[n])){rArray[n]=parseFloat(rArray[n])}}}else{rArray[rArray.length]=null}return rArray}function buildSortFunction(sortobj){var custO=[],localO=[],sc;if(T.isString(sortobj)){localO[0]=sortobj}else{if(T.isObject(sortobj)){localO=[sortobj]}else{localO=sortobj}}if(T.isArray(localO)){for(var sa=0,sal=localO.length;sa<sal;sa++){if(T.isString(localO[sa])){if(T.isString(TOb[0][localO[sa]])){custO[custO.length]={sortCol:localO[sa],sortDir:"asc",type:"string"}}else{custO[custO.length]={sortCol:localO[sa],sortDir:"asc",type:"number"}}}else{if(T.isObject(localO[sa])){for(sc in localO[sa]){if(localO[sa].hasOwnProperty(sc)){if(T.isString(TOb[0][localO[sa].sortCol])){custO[custO.length]={sortCol:sc,sortDir:localO[sa][sc],type:"string"}}else{custO[custO.length]={sortCol:sc,sortDir:localO[sa][sc],type:"number"}}}}}}}}return function(a,b){var returnvar=0,r1=a,r2=b,x,y,z;for(var sa=0,sal=custO.length;sa<sal;sa++){if(returnvar===0){x=r1[custO[sa].sortCol];y=r2[custO[sa].sortCol];if(custO[sa].type=="string"){x=(T.isString(x))?x.toLowerCase():x;y=(T.isString(y))?y.toLowerCase():y}if(custO[sa].sortDir=="desc"){if(T.isNull(y)||T.isUndefined(y)||y<x){returnvar=-1}else{if(T.isNull(x)||T.isUndefined(x)||x<y){returnvar=1}}}else{if(custO[sa].sortDir=="logical"){x=toLogicalArray(x);y=toLogicalArray(y);for(z=0,zl=y.length;z<zl;z++){if(x[z]<y[z]&&z<x.length){returnvar=-1;break}else{if(x[z]>y[z]){returnvar=1;break}}}if(x.length<y.length&&returnvar==0){returnvar=-1}else{if(x.length>y.length&&returnvar==0){returnvar=1}}}else{if(custO[sa].sortDir=="logicaldesc"){x=toLogicalArray(x);y=toLogicalArray(y);for(z=0,zl=y.length;z<zl;z++){if(x[z]>y[z]&&z<x.length){returnvar=-1;break}else{if(x[z]<y[z]){returnvar=1;break}}}if(x.length<y.length&&returnvar==0){returnvar=1}else{if(x.length>y.length&&returnvar==0){returnvar=-1}}}else{if(T.isNull(x)||T.isUndefined(x)||x<y){returnvar=-1}else{if(T.isNull(y)||T.isUndefined(y)||x>y){returnvar=1}}}}}}}return returnvar}}return{TAFFY:true,getLength:function(){return TOb.length},lastModifyDate:new Date(),find:function(matchObj,findFilter){var findIndex=0,findMatches=T.isArray(findFilter)?findFilter:TIA,matchType,matchValue,matchField,matchMode,pt,mi,fi,d,dl,md;if(T.isFunction(matchObj)){var thisMatchArray=[];for(d=0,dl=findMatches.length;d<dl;d++){if(matchObj(TOb[findMatches[d]],d)){thisMatchArray[thisMatchArray.length]=findMatches[d]}}findMatches=thisMatchArray}else{for(mi in matchObj){if(matchObj.hasOwnProperty(mi)){matchType="is";matchValue="";matchField=mi;matchMode={s:t,f:f};pt={};if(T.isObject(matchObj[mi])){for(fi in matchObj[mi]){if(matchObj[mi].hasOwnProperty(fi)){pt=findTests.pickTest(fi);matchType=pt.test;matchMode=pt.mode;matchValue=matchObj[mi][fi]}}}else{matchValue=matchObj[mi]}var thisMatchArray=[];d=0;dl=findMatches.length;for(;d<dl;d++){if(T.isArray(matchValue)&&matchType!="isSameArray"&&matchType!="hasAll"){if(matchMode.s){for(md=0;md<matchValue.length;md++){if(findTests.run(matchType,TOb[findMatches[d]][matchField],matchValue[md],matchMode)){thisMatchArray[thisMatchArray.length]=findMatches[d]}}}else{pt=1;for(var md=0;md<matchValue.length;md++){if(!findTests.run(matchType,TOb[findMatches[d]][matchField],matchValue[md],matchMode)){pt=0}}if(pt==1){thisMatchArray[thisMatchArray.length]=findMatches[d]}}}else{if(T.isFunction(matchValue)&&matchValue(TOb[findMatches[d]][matchField],d)){thisMatchArray[thisMatchArray.length]=findMatches[d]}else{if(findTests.run(matchType,TOb[findMatches[d]][matchField],matchValue,matchMode)){thisMatchArray[thisMatchArray.length]=findMatches[d]}}}}findMatches=thisMatchArray}}}findMatches=T.gatherUniques(findMatches);return findMatches},remove:function(dex){var removeIndex=bDexArray(dex,this.find);for(var di=0,dil=removeIndex.length;di<dil;di++){if(!T.isNull(this.onRemove)){this.onRemove(TOb[removeIndex[di]])}TOb[removeIndex[di]]="remove"}var removeRemaining=function(){for(var tdi=0,tdil=TOb.length;tdi<tdil;tdi++){if(TOb[tdi]==="remove"){return t}}return f};while(removeRemaining()){for(var tdi=0,tdil=TOb.length;tdi<tdil;tdi++){if(TOb[tdi]==="remove"){TOb.splice(tdi,1);this.lastModifyDate=new Date()}}}bTIA();return removeIndex},insert:function(newRecordObj){var rec=(TAFFY.isArray(newRecordObj))?newRecordObj:[newRecordObj];for(var x=0;x<rec.length;x++){if(!T.isNull(this.onInsert)){this.onInsert(rec[x])}TOb[TOb.length]=(TAFFY.isNull(conf.template))?rec[x]:TAFFY.mergeObj(conf.template,rec[x]);this.lastModifyDate=new Date();TIA[TIA.length]=TOb.length-1}return[TOb.length-1]},update:function(updateObj,dex){var updateIndex=bDexArray(dex,this.find),updateCount=0;for(var d=0,dl=updateIndex.length;d<dl;d++){var updateDex=updateIndex[d];if(!T.isNull(this.onUpdate)){this.onUpdate(updateObj,TOb[updateDex])}TOb[updateDex]=T.mergeObj(TOb[updateDex],updateObj);updateCount++}return updateIndex},get:function(dex){var nT=[],getIndex=bDexArray(dex,this.find);for(var d=0,dl=getIndex.length;d<dl;d++){nT[nT.length]=TOb[getIndex[d]]}return nT},first:function(dex){var getIndex=bDexArray(dex,this.find);return(getIndex.length>0)?TOb[getIndex[0]]:false},last:function(dex){var getIndex=bDexArray(dex,this.find);return(getIndex.length>0)?TOb[getIndex[(getIndex.length-1)]]:false},stringify:function(dex){return T.JSON.stringify(this.get(dex))},orderBy:function(Obj){if(TOb.length>0){if(T.isFunction(Obj)){var customSort=Obj}else{var customSort=buildSortFunction(Obj)}TOb.sort(customSort);this.lastModifyDate=new Date()}},forEach:function(func2call,dex){var forIndex=bDexArray(dex,this.find),row,nr;for(var fe=0,fel=forIndex.length;fe<fel;fe++){row=TOb[forIndex[fe]];nr=func2call(row,forIndex[fe]);if(T.isObject(nr)){if(TAFFY.isSameObject(nr,TAFFY.EXIT)){break}else{this.update(nr,forIndex[fe])}}}},sum:function(col,dex){var t=0;this.forEach(function(r){if(TAFFY.isNumeric(r[col])){t=t+r[col]}},dex);return t},max:function(col,dex){var t,f=0;this.forEach(function(r){if(f==1&&r[col]>t){t=r[col]}else{if(f==0){t=r[col];f=1}}},dex);return t},min:function(col,dex){var f=0,t;this.forEach(function(r){if(f==1&&r[col]<t){t=r[col]}else{if(f==0){t=r[col];f=1}}},dex);return t},values:function(col,dex){var t=[];this.forEach(function(r){t[t.length]=r[col]},dex);return t},uniqueValues:function(col,dex){var t=TAFFY();this.forEach(function(r){if(t.find({value:r[col]}).length===0){t.insert({value:r[col]})}},dex);return t.values("value")},config:{set:function(n,v){conf[n]=v;if(n=="template"&&!TAFFY.isNull(v)){mergeTemp(TIA,v)}},get:function(n){return conf[n]}},applyTemplate:function(tmp,dex){var getIndex=bDexArray(dex,this.find);mergeTemp(getIndex,tmp)},onUpdate:null,onRemove:null,onInsert:null}};TAFFY.typeOf=function(v){var s=typeof v;if(s==="object"){if(v){if(typeof v.length==="number"&&!(v.propertyIsEnumerable("length"))&&typeof v.splice==="function"){s="array"}}else{s="null"}}return s};TAFFY.JSON=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value,whitelist){var r=/["\\\x00-\x1f\x7f-\x9f]/g,v,a,i,k,l;function stringifyString(){return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"'}function stringifyObject(){if(!value){return"null"}if(typeof value.toJSON==="function"){return stringify(value.toJSON())}a=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i],whitelist)||"null")}return"["+a.join(",")+"]"}if(whitelist){l=whitelist.length;for(i=0;i<l;i+=1){k=whitelist[i];if(typeof k==="string"){v=stringify(value[k],whitelist);if(v){a.push(stringify(k)+":"+v)}}}}else{for(k in value){if(typeof k==="string"){v=stringify(value[k],whitelist);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}switch(typeof value){case"string":return stringifyString();case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":return stringifyObject()}return""}return{stringify:stringify,parse:function(text,filter){var j;function walk(k,v){var i,n;if(v&&typeof v==="object"){for(i in v){if(Object.prototype.hasOwnProperty.apply(v,[i])){n=walk(i,v[i]);if(n!==undefined){v[i]=n}else{delete v[i]}}}}return filter(k,v)}if(/^[\],:{}\s]*$/.test(text.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof filter==="function"?walk("",j):j}throw new SyntaxError("parseJSON")}}}();TAFFY.mergeObj=function(ob1,ob2){var c={};for(var n in ob1){if(ob1.hasOwnProperty(n)){c[n]=ob1[n]}}for(var n in ob2){if(ob2.hasOwnProperty(n)){c[n]=ob2[n]}}return c};TAFFY.getObjectKeys=function(ob){var kA=[];for(var n in ob){if(ob.hasOwnProperty(n)){kA[kA.length]=n}}return kA.sort()};TAFFY.isSameArray=function(ar1,ar2){return !!(TAFFY.isArray(ar1)&&TAFFY.isArray(ar2)&&ar1.join(",")==ar2.join(","))};TAFFY.isSameObject=function(ob1,ob2){var T=TAFFY;if(T.isObject(ob1)&&T.isObject(ob2)){if(T.isSameArray(T.getObjectKeys(ob1),T.getObjectKeys(ob2))){for(var n in ob1){if(ob1.hasOwnProperty(n)){if((T.isObject(ob1[n])&&T.isObject(ob2[n])&&T.isSameObject(ob1[n],ob2[n]))||(T.isArray(ob1[n])&&T.isArray(ob2[n])&&T.isSameArray(ob1[n],ob2[n]))||(ob1[n]==ob2[n])){}else{return false}}}}else{return false}}else{return false}return true};TAFFY.has=function(var1,var2){var T=TAFFY,re=true;function checkObject(){if(T.isObject(var2)){for(var x in var2){if(re===true&&var2.hasOwnProperty(x)&&!T.isUndefined(var1[x])&&var1.hasOwnProperty(x)){re=T.has(var1[x],var2[x])}else{return false}}return re}else{if(T.isArray(var2)){for(var x=0;x<var2.length;x++){re=T.has(var1,var2[x]);if(re===true){return true}}}else{if(T.isString(var2)&&!TAFFY.isUndefined(var1[var2])){return true}}}}function checkArray(){if(T.isObject(var2)){for(var n=0;n<var1.length;n++){re=T.has(var1[n],var2);if(re==true){return true}}}else{if(T.isArray(var2)){for(var x=0;x<var2.length;x++){for(var n=0;n<var1.length;n++){re=T.has(var1[n],var2[x]);if(re==true){return true}}}}else{if(T.isString(var2)){for(var n=0;n<var1.length;n++){re=T.has(var1[n],var2);if(re==true){return true}}}}}}function checkString(){if(T.isString(var2)&&var2==var1){return true}return false}function checkOther(){if(T.typeOf(var1)==T.typeOf(var2)&&var1==var2){return true}return false}if(T.isTAFFY(var1)){re=var1.find(var2);if(re.length>0){return true}return false}switch(T.typeOf(var1)){case"object":return checkObject();case"array":return checkArray();case"string":return checkString();default:return checkOther()}};TAFFY.hasAll=function(var1,var2){var T=TAFFY;if(T.isArray(var2)){var ar=true;for(var i=0,il=var2.length;i<il;i++){ar=T.has(var1,var2[i]);if(ar==false){return ar}}return true}return T.has(var1,var2)};TAFFY.gatherUniques=function(a){var uniques=[],aLen=a.length,z=0,uniquesLen,d,c;for(;z<aLen;z++){d=true;uniquesLen=uniques.length;for(c=0;c<uniquesLen;c++){if(uniques[c]==a[z]){d=false}}if(d==true){uniques.push(a[z])}}return uniques};(function(ts){for(var z=0;z<ts.length;z++){(function(y){TAFFY["is"+y]=function(c){return(TAFFY.typeOf(c)==y.toLowerCase())}})(ts[z])}})(["String","Number","Object","Array","Boolean","Null","Function","Undefined"]);TAFFY.isNumeric=function(sT){return !isNaN(sT)&&Math.floor(sT)==sT};TAFFY.isTAFFY=function(oB){return !!(TAFFY.isObject(oB)&&oB.TAFFY)};TAFFY.EXIT={EXIT:true};window.TAFFY=TAFFY})(this);
